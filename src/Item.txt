//'use server'
//import { Suspense } from "react";//
import worker_threads, { parentPort, workerData } from 'node:worker_threads';
//import child_process from 'node:child_process';
//const { Worker, isMainThread, parentPort } = require('worker_threads');
import statusMap from './app/statusMap'
//import Singleton from './Singleton'
//proxy object
class Item {
  static count = 0;
  static arrObj = new Map();
  constructor(id) {
    if (Item.arrObj.get(Number(id)) === undefined) {
      this.id = id
      this.status = false//new Status()
      //statusMap.set(Number(id), this.status)
      this.getStatus = this.getStatus.bind(this);
      this.setStatus = this.setStatus.bind(this);
      statusMap.set(Number(this.id), this.status)
      Item.arrObj.set(Number(id), this)
    }
    //console.log('constructor', id)
  }
  // Item.instance = this; // Сохраняем экземпляр
  //}
  /*static async getStaticProperty(){
    return Item.arrObj
  }
  static async setStaticProperty(newValue){
    return Item.arrObj.set(Number(id), newValue)
  }*/
  async getStatus() {
    //console.log('getStatus', this.id, this.status)
    if (this.status === true) {
      //await Item.setCount(1)
      return 'В КОРЗИНЕ'
    } else {
      //await Item.setCount(-1)
      return 'ЗАКАЗАТЬ'
    }
  }
  //this.fullName = function() {
  async setStatus() {
    //console.log('setStatus old', this.id, this.status)
    this.status = !this.status
    //console.log('setStatus new', this.id, this.status)
    /*if (Number(this.status) === 1) {
      await Item.setCount(1)
    }
    else {
      await Item.setCount(-1)
    }*/
    //Item.arrObj.set(Number(this.id), this)
    // if (statusMap.get(Number(this.id)) === undefined) {
    statusMap.set(Number(this.id), this.status)
    // }
  }
  static async staticReturn() {
    //console.log('findById', ppp, typeof ppp)
    return Item.arrObj;
  }
  static async setCount(value) {
    Item.count = Item.count + value
  }
  static async getCount() {
    return Item.count
  }
}
export default Item